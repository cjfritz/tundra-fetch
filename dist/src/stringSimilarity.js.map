{"version":3,"sources":["../../src/stringSimilarity.js"],"names":["WILDCARD_MARKER_ESCAPED","WILDCARD_MARKER","UNQUOTED_WILDCARD_PLACEHOLDER","getIsMatch","source","target","wildcardedSource","replace","RegExp","isMatch","recursiveKeySort","data","sortedData","Object","keys","sort","forEach","key","Array","isArray","values","replaceWildcards","value","processedValue","searchUnquotedWildcards","resultArray","exec","matchedString","matchedStringIndex","lastIndex","length","isWildcardInQuotes","startsWith","endsWith","matchWithWildcardPlaceholder","matchWithPlaceholderAndQuotes","concat","processedPortion","slice","remainingPortion","restoreWildcards","searchUnquotedWildcardPlaceholders","matchWithRestoredWildcard","restoredMatch","substr","shouldSortObjectKeys","isMatching","processedSource","processedTarget","JSON","parse","includes","Error","stringify","console","log","e"],"mappings":"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","file":"stringSimilarity.js","sourcesContent":["import escapeRegExp from 'lodash.escaperegexp';\nimport matcher from 'matcher';\nimport { isObject } from './helpers';\n\nexport const WILDCARD_MARKER_ESCAPED = '{{\\\\*}}';\nexport const WILDCARD_MARKER = '{{*}}';\nexport const UNQUOTED_WILDCARD_PLACEHOLDER = '{{%}}';\n\nconst getIsMatch = (source, target) => {\n  const wildcardedSource = source\n    .replace(new RegExp(escapeRegExp('*'), 'g'), '\\\\*')\n    .replace(new RegExp(escapeRegExp(WILDCARD_MARKER_ESCAPED), 'g'), '*');\n\n  return matcher.isMatch(target, wildcardedSource);\n};\n\nexport const recursiveKeySort = (data) => {\n  if (data && isObject(data)) {\n    const sortedData = {};\n    Object.keys(data).sort().forEach((key) => {\n      sortedData[key] = recursiveKeySort(data[key]);\n    });\n    if (Array.isArray(data)) {\n      return Object.values(sortedData);\n    }\n    return sortedData;\n  }\n  return data;\n};\n\nexport const replaceWildcards = (value) => {\n  let processedValue = value;\n  const searchUnquotedWildcards = new RegExp(/(([^:\\s,]*)\\{\\{\\*\\}\\}([^,:\\s}\\]]*))(?=[^,:}\\]\\s]*)/g);\n  let resultArray = searchUnquotedWildcards.exec(processedValue);\n\n  while (resultArray !== null) {\n    const matchedString = resultArray[0];\n    const matchedStringIndex = searchUnquotedWildcards.lastIndex - matchedString.length;\n    const isWildcardInQuotes = matchedString.startsWith('\"')\n      && matchedString.endsWith('\"');\n\n    if (!isWildcardInQuotes) {\n      const matchWithWildcardPlaceholder = matchedString\n        .replace(WILDCARD_MARKER, UNQUOTED_WILDCARD_PLACEHOLDER);\n      const matchWithPlaceholderAndQuotes = '\"'.concat(matchWithWildcardPlaceholder.concat('\"'));\n      const processedPortion = processedValue.slice(0, matchedStringIndex);\n      let remainingPortion = processedValue.slice(matchedStringIndex);\n      remainingPortion = remainingPortion.replace(matchedString, `${matchWithPlaceholderAndQuotes}`);\n      processedValue = processedPortion + remainingPortion;\n    }\n    resultArray = searchUnquotedWildcards.exec(processedValue);\n  }\n  return processedValue;\n};\n\nexport const restoreWildcards = (value) => {\n  let processedValue = value;\n  const searchUnquotedWildcardPlaceholders = new RegExp(/(([^:\\s,]*)\\{\\{%\\}\\}([^,\\s}\\]]*))(?=[^,}\\]\\s]*)/g);\n  let resultArray = searchUnquotedWildcardPlaceholders.exec(processedValue);\n\n  while (resultArray !== null) {\n    const matchedString = resultArray[0];\n    const matchWithRestoredWildcard = matchedString\n      .replace(UNQUOTED_WILDCARD_PLACEHOLDER, WILDCARD_MARKER);\n    const restoredMatch = matchWithRestoredWildcard.substr(1, matchWithRestoredWildcard.length - 2);\n    processedValue = processedValue.replace(matchedString, `${restoredMatch}`);\n    resultArray = searchUnquotedWildcardPlaceholders.exec(processedValue);\n  }\n  return processedValue;\n};\n\nexport default (source, target, shouldSortObjectKeys) => {\n  if (!source || (source || '') === (target || '')) {\n    return source === target;\n  }\n\n  const isMatching = getIsMatch(source, target);\n\n  if (isMatching) {\n    return true;\n  }\n\n  if (shouldSortObjectKeys && source && target) {\n    try {\n      let processedSource = `${source}`;\n      let processedTarget = `${target}`;\n\n      processedSource = replaceWildcards(processedSource);\n      processedSource = JSON.parse(processedSource, (key, value) => {\n        if (key.includes(WILDCARD_MARKER)) {\n          throw new Error();\n        }\n        return value;\n      });\n      processedSource = JSON.stringify(recursiveKeySort(processedSource));\n      processedSource = restoreWildcards(processedSource);\n\n      processedTarget = JSON.parse(processedTarget);\n      processedTarget = JSON.stringify(recursiveKeySort(processedTarget));\n\n      if (source.includes('ws_loadplanning_360_offerCompositeService/create/conditional')) {\n        console.log('source:', processedSource);\n        console.log('target:', processedTarget);\n      }\n\n      return getIsMatch(processedSource, processedTarget);\n    } catch (e) {\n      return false;\n    }\n  }\n\n  return false;\n};\n"]}